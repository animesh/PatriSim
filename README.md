# README

Pipeline simulating human genomes under scenarios with different descent (bilateral, patrilineal, matrilineal) and residence (patrilocal, matrilocal) rules and computing diversity estimators on simulated genetic data.

## Summary

To run this pipeline, modify the `PARAMETERS` section in the file `main.sh` for the regular scenario (Fig 1 in article) or `main_transition.sh` for the extended scenario (Fig 5 in article). See "Parameters information" to have a description of each parameter. Then execute the .sh file with bash in a terminal. 

eg. `bash main.sh`

This pipeline:
1) simulates autosomes, X chromosomes, Y chromosomes and mtDNA under the scenario specified by the parameters using the sofware SLiM (see "SLiM models"). 
2) converts SLiM outputs into VCF files with custom python scripts (see "Output VCF")
3) computes nucleotide diversity using custom python scripts (see "Nucleotide diversity")
4) generates BEAST output to draw Bayesian Skyline Plots (see "Bayesian inference")

NB: if you already ran the script once, it is recommended to comment lines of code running the `burnin` script.


## Parameters information

`dir`: input path

`chr_size`: vector of chromosome sizes. First element: autosomes and X. Second element: Y chromosome. Third element: mtDNA.

`random_fission`: true or false. If true, the fission type is random.

`transmission`: "full" or "half". If "full", the growth rate of a splitting descent group is transmitted to the two resulting descent groups after the fission event. If "half" it is transmitted to one out of the two new groups.

`fission_threshold`: number of individuals from which a descent group splits

`friendlyFission`: "T" or "F". If "T", the two resulting groups stay in the village of the splitting group after a fission event. If "F", one of the two resulting groups migrate to a new village.

`violence`: true or false. If true, there is violent intergroup competition between descent groups.

`descent`: "unilineal" or "bilateral"

`descent_rule`: "patrilineal" or "matrilineal"

`residence_rule`: "patrilocal" or "matrilocal" or "na"

`nb_villages`: number of villages in the population

`nb_groups`: nb of descent groups -> does not make sense for bilateral descent but usefull to normalize villages' sizes

`K`: initial number number of individuals per descent group

`polygyny`: "F" or "T". If "T", males mate with several women (change the slim code to modify the rate of polygyny)

`e`: extinction rate. Proportion of males killed at each generation.

`migration_rate`: proportion of individudals migrating to a new village at each generation.

`sigma`: variance of the normal law used to draw growth rates

`growth_rate`: growth rate of villages and outgroup, if 0 : population has a constant size

`sample_size`: number of individuals to sample in each village

`nbsimu`: number of replicates

`cores`: number of cores

`nameDir`: name of the output directory

## SLiM models
*Contains .slim files modeling populations with different descent (patrilineal, matrilineal, bilateral) and post-marital residence rules (patrilocal, matrilocal)*

- **burnin.slim**: simulate a panmictic population made of `K_total` individuals for 20,000 generations. This preliminary simulation is taken in entry of the models of villages with bilateral or unilineal descent. 

- **bilateral_descent.slim**: simulates autosomes, X, Y chromosomes and mtDNA in `N` villages, each containing `K` individuals at the beginning of the simulation for 100 generations. These villages exchange migrants at a rate `m`, with a proportion of females `mf/m` determined by the `residence_rule`. See Fig 1.

- **unilineal_descent.slim**: simulates autosomes, X, Y chromosomes and mtDNA in `N` villages, each containing `K` individuals divided into `nb_groups` descent groups at the beginning of the simulation for 100 generations. These villages exchange migrants at a rate `m`, with a proportion of females `mf/m` determined by the `residence_rule`. The descent rule is defined by `descent_rule`. See Fig 1.

- **unilineal_descent_extended.slim**: see Fig 5. 

## Output VCF
*.py scripts taking .trees files (generated by simulating populations in SLiM) in entry to produce .vcf files for each chromosome and each village in every simulation*

In `Python_scripts` folder:
- **subset_trees_villages_bilateral_descent.py**
- **subset_trees_villages_unilineal_descent.py**

## Nucleotide diversity
*.py files used to compute diversity metrics (Pi) from .vcf files*

In `Python_scripts` folder:
- **metrics.py** : file containing functions to compute alleles frequencies and diversity metrics

- **Pi_villages.py** : compute nucleotidic diversity for models of villages

- **Global_Pi_villages.py** : compute global nucleotidic diversity for models of villages

## Bayesian inference
*generates .nex BEAST inputs and run beauti and BEAST softwares*

In `Python_scripts` folder:
- **write_nexus_bilateral.py**
- **write_nexus.py**

In `BEAST` folder:

- **transform_nexus.sh**
- **template_Y.xml**
- **template_Mito.xml**
